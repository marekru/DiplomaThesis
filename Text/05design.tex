\chapter{Návrh vizualizácie}
(1) What is visualized? \\
(2) Why is it visualized? \\
(3) How is it visualized? \\
str. 99\\
tato kapitola zodpoveda vsetky 3 otazky \\

\section{Špecifikácia požiadaviek na vizualizáciu}

\subsection{Charakteristika dát}
V prvom rade nám do verifikácie vstupujú surové dáta, ktorými sú pozorovania a predpovede.\\
- Surove data\\
--- pozorovania \\
--- predpovede \\
- Spracovane data \\
--- chyby \\
--- statistiky \\
------------------\\
- Numericke \\
- Ordinalne \\
- Spojité \\
--------------------\\
- Casovo orientovane \\
--- Scale (Skala): diskretny cas \\
--- Scope (Rozsah): point-based aj interval-based \\
--- Arrangment (Usporiadanie) : linearny \\
--- Viewpoint (Nahliadanie): usporiadane \\
--- Granularity: single \\
--- Time primitives: moment \\
--- Determinancy (Determinovanost): determinovane \\ 
------------------\\



\section{Návrh vizualizácie štatistík verifikácie} 
Štatistiky verifikácie sú dáta v časových radoch. V sekcii \ref{sec:linegraph} sme uviedli, že bežne používaným a veľmi účinným spôsobom vizualizácie časových radov je čiarový diagram. V našej práci sme sa odrazili od tohto faktu a navrhli sme dva pohľady na dáta. Jednak je to prehľad jedného druhu štatistík pre danú premennú počas skúmaného intervalu a druhým pohľadom je detail jedného časového podintervalu s rôznymi štatistikami alebo premennými.

\subsection{Prehľad štatistík}
Ako sme spomenuli vyššie, na vizualizáciu časových radov sa bežne používa čiarový diagram. Z našej skúsenosti vieme, že táto technika nie je vhodná pre porovnávanie mnohých chronologicky usporiadaných radov súčasne. Problémom je, že ak umiestnime viacero radov do jedného grafu, tak strácame informáciu o chronologickom poradí. Ak však umiestnime rady do grafov jednotlivo, tak pre väčšie množstvo dát nebudeme mať dostatočne veľký priestor.

Zvolili sme preto pomerne jednoduché a účinné riešenie, zobraziť štatistiky na iný vizuálny parameter, konkrétne na farbu. Jednotlivé hodnoty sa teda v grafe zobrazia ako za tesne sebou umiestnené farebné obdĺžniky \footnote{Experimentovali sme taktiež s inými tvarmi (kruhy a obdĺžniky so zaoblenými hranami), ale aj s rôznymi veľkostami medzier medzi tvarmi. Použité nastavenie sa však ukázalo ako najvhodnejšie pri porovnávaní hodnôt vo vertikálnom aj horizontálnom smere.}, ktoré vytvoria jeden celistvý pás (pozri porovnanie s čiarovým diagramom na obrázku \ref{fig:colormap}a. Umiestnením takýto pásov pod seba vytvoríme farebnú mapu štatistík. Výslednú vizualizáciu možno vidieť na obrázku \ref{fig:colormap}b. 

V našej aplikácii sa tento spôsob vizualizácie použil v dvoch prípadoch. Prvým prípadom bolo zobrazenie mesačných štatistík, pre 48 hodinové predpovede. Teda sme mali 12 mesiacov v roku a pre každý mesiac 48 hodnôt, čo sa nám zobrazilo ako farebná mapa $ 12 \times 48 $ (pozri obrázok \ref{fig:colormap}b). Druhým prípadom bolo zobrazenie chýb pre konkrétne predpovede, ktorých mohlo byť variabilný počet podľa nastavení systému. Zvyčajne však išlo približne o 30 predpovedí pre každý mesiac.

\begin{figure}
	\centering
	\hspace*{-0.45in}
	\includegraphics[width = 7.0in, height = 2.2in]{colormap}
	\caption{a) Konštrukcia jedného pásu zobrazením hodnôt grafu na farebnú škálu b) Výsledná vizualizácia, ako farebná mapa }
	\label{fig:colormap}
\end{figure}

\subsection{Detail štatistík}
Napriek tomu, že zobrazením hodnôt na farbu nestrácame žiadnu informáciu, je dokázané, že človek nedokáže tak dobre porovnávať farby, ako napríklad vzdialenosti. Preto predošle spomenutá technika je síce vhodná na preskúmanie celého intervalu ako celku, avšak nie na detailné porovnávanie hodnôt v čase. Z tohto dôvodu sme sa rozhodli použiť taktiež spomínaný čiarový diagram. 

Tento typ diagramu poskytuje dostatočne veľký vizuálny priestor na to, aby sme doň mohli pridať ďalšie dáta. Rozhodli sme sa preto umožniť užívateľovi vizualizovať buď rôzne druhy štatistík súčasne pre danú predpoveď a veličinu (napr RMSE, MAE, MFE), alebo tiež rôzne veličiny (napr. tlak, teplotu, zrážky) pre túto predpoveď. V prvom prípade nám postačí jednotná škála, keďže sa hodnoty zväčša nachádzajú v podobnom rozmedzí. V druhom prípade je potrebných viacero škál, keďže napríklad chyby teploty sa pohybujú v rozmedzí 5 stupňov, tak chyby tlaku sa pohybujú v rozmedzí stoviek. Ak by sme tieto dve veličiny vizualizovali spolu, tak krivka teploty by bola sploštená natoľko, že by nebolo možné z nej odčítať hodnoty.

Vytvorenie mnoho-čiarového diagramu s jednotnou škálou je jednoduché, keďže sa na dizajne grafu nič nemení, len sa pridá ďalšia krivka. Pri viacerých rôznych škálach sa musia zobraziť aj tieto škály. Zvyčajne sa umiestňujú striedavo vľavo a vpravo, postupne za sebou smerom od stredu grafu. Problém však spočíva v tom, že pri väčšom počte nemôžme určiť, ktorá škála patrí ku ktorej krivke a s postupujúcou vzdialenosťou škály od grafu sa znižuje schopnosť užívateľa odčítavať hodnoty zo škály. V našej práci sme navrhli jednoduché spôsob, akým sme sa pokúsili vyriešiť oba problémy súčasne.

Naše riešenie spočíva v tom, že každá škála sa zobrazí ako obdĺžnik vyplnený farbou krivky, ktorá prislúcha k danej škále. Taktiež čiaročky indikujúce hodnoty v danom bode sa zobrazia pravidelne a v rovnakej vzdialenosti pre každú škálu.

Na obrázku \ref{fig:multilinegraph} môžme vidieť porovnanie bežne používaného spôsobu zobrazenia škál a nášho spôsobu. Náš spôsob jednoznačne priraďuje, pomocou farby, krivky ku škálam a jednotné a pravidelné rozmiestnenie indikátorov  hodnôt nám rieši problém pri odčítavaní hodnôt, keďže nie je potrebné sa dívať na vzdialené škály.


\begin{figure}
	\centering
	\includegraphics[width = 5in]{multilinegraph}
	\caption{a) Bežné zobrazenie viacerých škál b) Nami navrhnuté zobrazenie viacerých škál }
	\label{fig:multilinegraph} %TODO namiesto nul tam dat cisla
\end{figure}

\section{Návrh vizualizácie distribúcie chýb}
Pri verifikácii predpovede spojitej premennej sme použili štatistické metódy spomenuté v sekcii \ref{sec:errormeasurement}, ktorých výsledok sme následne vizualizovali. Pôvodné dáta však zostali skryté za použitým matematickým modelom, a tak sme stratili informáciu o distribúcii chyby. Pri verifikácii sa štandardne používajú dve metódy na priamu, či nepriamu vizualizáciu a analýzu distribúcie, ktoré sme opísali v sekcii \ref{sec:prevvis}. Týmito metódami sú bodový graf (pozri podsekciu \ref{subsec:scatterplot}) a krabicový diagram (pozri podsekciu \ref{subsec:boxplot}).

Pri návrhu vizualizácie sme vyskúšali niekoľko vizualizačných techník a zvážili ich silné a slabé stránky. 

\subsection{Graf hustoty} %Density plot

Jedným z viacerých spôsobov, ako pomerne presne určiť distribúciu chýb je pomocou \textit{grafu hustoty}. Ten sa skonštruuje jednoducho z \textit{funkcie hustoty}, ktorú získame \textit{odhadom hustoty} z dát. 

Prvý pohľad na dáta by nám vravel, že ide o dvojrozmerné dáta a teda je potrebné použiť odhad hustoty dvoch premenných. Takýto postup by samozrejme bol možný, ale doviedol by nás k chybnej vizualizácii a tak aj k mylnej predstave o dátach. Dôvodom je to, že máme záujem o analýzu distribúcie chýb pre každú hodinu predpovede zvlášť, čo znamená, že chcem zistiť distribúciu iba v jednom smere.

Pre vytvorenie grafu hustoty, v prvom rade je potrebné vybrať správny spôsob odhadu hustoty. Jedným z bežne používaným štandardným spôsobom je odhad hustoty pomocou jadra, po anglicky známy ako \textit{kernel density estimation} (KDE) [ref Rosenblatt 56, parzen 62].

Nech máme $ n $ hodnôt $ x_{i}, 1 \leq i \leq n $, z ktorých chceme určiť odhad hustoty, potom estimátor hustoty $ \hat{f}_h(x) $, ktorý aproximuje \textit{funkciu hustoty pravdepodobnosti} (PDF) $ f $, sa vypočíta takto:
\[
	\hat{f}_h(x) = \dfrac{1}{nh} \sum_{i=0}^{n}K\Big(\dfrac{x - x_{i}}{h}\Big)
\]
kde $ h $ je šírka jadra a $ K(x) $ je funkcia jadra (skrátene iba jadro), ktorá by mala spĺňať nasledovné vlastnosti:
\[  K(x) \geq 0 \]
\[  \int K(x) dx = 1 \]
tieto vlastnosti hovoria, že $ K(x) $ je na celom definičnom obore nezáporná a jej integrál je rovný 1, teda sa jedná o normalizovanú funkciu. Bolo preštudovaných mnoho jadier, ako napríklad uniformné, tri-angulárne, Epanechnikovo [29], kvadratické, Gaussové, kosínusové a veľa ďalších. Najbežnejšie a zrejme aj najpraktickejšie [18] je Gaussovo (normálne) jadro, ktoré sme použili aj my:
\[
	K(x) = \dfrac{1}{\sqrt{2\pi}}e^{-\frac{1}{2}x^2}
\]
Voľba jadra však nemá na výsledok až taký vplyv, ako voľba šírky jadra $ h $. My sme použili výpočet šírky jadra na základe dátovej množiny, ktorý aproximuje optimálnu šírku jadra [Scott 1992; Bowman and Azzalini 1997] \footnote{Optimálna šírka jadra je taká, ktorá minimalizuje \textit{strednú integrovanú kvadratickú chybu}.}. Všeobecne pre $ d $ dimenzionálne dáta je vzorec nasledovný:
\[
	h = \sigma \Big(\frac{4}{(d + 2)n}\Big)^{\frac{1}{d+4}}
\]
kde $ \sigma $ je smerodajná odchýlka vypočítaná z daných dát a $ n $ je veľkosť dátovej množiny. V našom prípade je $ d = 1 $, a tak sa nám vzorec zjednoduší na
\[
	h = \sigma \Big(\dfrac{4}{3n}\Big)^{\frac{1}{5}}
\] 
Aby sme zjednodušili výpočet, tak sme si konštanty vypočítali predom a zaokrúhlili na 2 desatinné miesta, čo považujeme za dostačujúce. Výsledný vzorec, ktorý sa nakoniec objavil v aplikácii je takýto:
\[
	h = 1.06 \times \sigma \times n^{-\frac{1}{5}}
\]

Takýmto spôsobom sme si pre každú hodinu predpovede určili samostatnú funkciu $ \hat{f}_{h}(x) $, ktorú môžme vizualizovať. Zvyčajne sa funkcie hustoty vizualizujú ako bežné funkcie, teda pomocou čiarového diagramu, tak ako na obrázku \ref{fig:XY}. V našom prípade by bol tento prístup nepraktický, keďže máme veľké množstvo funkcií, tak jednak by bola takáto vizualizácia nepraktická pri porovnávaní distribúcií a taktiež na to nemáme potrebný vizuálny priestor.

Opäť sme teda zvolili štandardné riešenie, ako ušetriť vzácny priestor a to tak, že hodnoty, ktoré by boli zobrazené na $ y $-ovú os zobrazíme na zvolenú farebnú škálu. Vďaka tomu by teoreticky mohol mať graf hustoty pre jeden čas predpovede šírku 1 pixel bez straty akejkoľvek informácie.

Vieme, že pre ľudí nie je také jednoduché pozorovať malé rozdiely medzi dvoma farbami. Testovaním sme zistili, že pri takejto vizualizácii, že tento fakt spôsobuje problémy aj pri našej vizualizácii, kedy sa pre pozorovateľa strácajú výkyvy hodnôt
% TODO najst dobre riesenie na toto a potom to dopisat
% riesenie su 2 - bud palettu ako navrhoval novotny, alebo pozuit ten typ grafu, co sa tak preryva do seba
% Two-tone pseudo coloring: compact visualization for one-dimensional data
% Horizon Graph


\subsection{Pruhový kvantilový diagram} 
Z časti \ref{subsec:scatterplot} sme už dobre oboznámený s pojmom kvantil. Klasický kvantilový diagram [ref] zobrazuje kvantil hodnôt pre jednu dimenziu. Ak si vezmeme naše dáta, kde pre každý čas je niekoľko chýb predpovedí, tak kvantilový diagram skonštruujeme tak, že pre každý čas vypočítame kvantil, ktorý zobrazíme ako bod alebo ako súčasť lomenej čiary v grafe.
Prirodzeným rozšírením je zobrazovať nielen jeden kvantil, ale mnoho kvantilov súčasne. Zvyčajne sú to tieto kvantily $ Q_{0.02}, Q_{0.98}, Q_{0.25}, Q_{0.75}, Q_{0.5} $. V našej práci sme využili toto rozšírenie na lepšie zobrazenie distribúcie a navrhli sme takzvaný \textit{pruhový kvantilový diagram}.

Jeden \textit{pruh} v grafe definujeme pomocou dvojíc hodnôt v čase - spodným a jeho protiľahlým kvantilom. Spodným kvantilom je kvantil $ Q_{\alpha} $ a k nemu protiľahlý je kvantil $ Q_{1 - \alpha} $, kde $ 0 \leq \alpha \leq \frac{1}{2} $. Vidíme teda, že pruh ohraničuje hodnoty v okolí stredu usporiadanej množiny dát. Špeciálnym prípadom pruhu je pre $ \alpha = \frac{1}{2} $, vtedy spodný aj horný kvantil je $ Q_{0.5} $, čo je vlastne medián.

Pri návrhu vizualizácie sme sa snažili, aby mohol mať diagram variabilný počet pruhov a taktiež, aby rozostup medzi pruhmi bol pravidelný. Pri riešení tohto problému, sme sa inšpirovali krabicovým diagramom, kde sa hodnoty delia mediánom na dve časti, ktoré sa ďalej taktiež delia ich mediánom. Ide teda o rekurzívne delenie usporiadanej množiny na polovicu do hĺbky 2. Túto myšlienku sme rozšírili na ľubovoľnú hĺbku delenia $ d $. Potom $ i $-ty pruh $ \mathcal{P}_{d}(i) $ pre hĺbku $ d $ definujeme takto:
\[
	p_{d}(i) = (Q_{\alpha},Q_{1 - \alpha}) , \alpha = i \times (0.5)^d 	
\]
\[
	\mathcal{P}_{d}(i) = \{ (t,p_{d}(i)) : t \in I \}
\]
a množina všetkých pruhov grafu pre hĺbku delenia $ d $ je definovaná takto:
\[
	\{ \mathcal{P}_{d}(i) : 0 \leq i \leq 2^{d-1} , i \in \mathbb{N} \}
\]
Aby sme sa vyhli rekruzii, vypočítali sme si krok medzi susednými kvantilmi pri hĺbke $ d $, ktorý je $ (0.5)^d $, a jednotlivé pruhy sme generovali s týmto krokom. Pri rekruzívnom delení sa vygeneruje $ 2^d $ kvantilov a z nich je možné vyrobiť $ 2^{d - 1} $ pruhov, preto sme index $ i $ obmedzili na $ i \leq 2^{d-1} $. Z tohto vidíme, že počet pruhov grafe s rastúcou hĺbkou rastie exponenciálne, preto odporúčame, aby $ d $ bolo maximálne 4, kedy sa nám množina rozdelí na 16 častí 15 hexadecilmi a tak vznikne 8 pruhov.

% TODO obrázok 
Na obrázku \ref{fig:pruh} vidíme, že takto definovaný pruh sa potom vizualizuje, ako plocha medzi krivkami, ktoré tvoria dvojice hodnôt patriace danému pruhu, s výnimkou špeciálneho prípadu $ Q_{0.5} $, ktorý vizualizujeme ako krivku.



%TODO toto musím ešte celé premyslieť!


\subsection{Funkčný krabicový diagram}
Pre pochopenie dát je dôležité, aby sme sa vedeli pozrieť na hodnoty v ich kontexte. Všetky predošlé techniky uvažovali o chybe ako o samostatnej hodnote pre určitý predpovedný čas, avšak chyby sa nenachádzajú len v kontexte predpovedného času, ale aj v kontexte konkrétnej predpovede. Preto môžme uvažovať o predpovediach ako o funkciách $ x_{i}(t) $, kde $ i \in \{1..n\}$ je poradie predpovede a $ t \in I $ je čas predpovede, kde $ I $ je časový interval predpovede z $ \mathbb{R} $ (v našom prípade sa jednalo o dvojdňovú, teda 48 hodinovú predpoveď).

Takýmto spôsobom sme sa dostali do novej situácie, kedy nechceme vizualizovať distribúciu jednotlivých chýb, ale celých predpovedí, ktoré chápeme ako funkcie. Na riešenie tohto problému existuje niekoľko spôsobov, z ktorých sme si zvolili \textit{funkčný krabicový diagram} \cite{FunctionalBoxplot}, keďže myšlienkovo vychádza z klasického krabicového diagramu, ktorý je jednak na túto situáciu vhodný ale je tiež medzi užívateľmi dobre známy a zaužívaný.

Ako sme spomenuli v časti \ref{subsec:boxplot}, klasický krabicový diagram potrebuje na svoju konštrukciu 5 hodnôt: 3 kvartily a 2 extrémy. Aby sme tieto hodnoty našli pre funkcie, musíme ich vedieť porovnať a povedať, ktorá je \textquotedblleft väčšia\textquotedblright alebo \textquotedblleft menšia\textquotedblright. Autori funkčného krabicového diagramu riešia problém s využitím takzvanej pásmovej hĺbky (\textit{band depth}) \cite{BandDepth}. Grafom $ G $ funkcie $ x $ je množina bodov $ G = \{ (t,x(t)) : t \in I \} $. Pásmo $ \mathcal{B} $ (\textit{band}) v $ \mathbb{R}^{2}  $ ohraničené krivkami $ x_{i_{1}}, x_{i_{2}}, .. , x_{i_{k}} $, kde $ k \geq 2 $ je definované takto:
\[
	\mathcal{B}(x_{i_{1}}, x_{i_{2}}, .. , x_{i_{k}}) = \{ (t,y) : t \in I, \min_{r=1..k}x_{i_{r}}(t) \leq y \leq \min_{r=1..k}x_{i_{r}}(t) \}
\]
Pásmo $ \mathcal{B} $ je teda množina všetkých bodov existujúcich medzi extrémami všetkých kriviek, ktoré doň vstupujú ako parameter. 
Pomocou týchto dvoch funkcií môžme definovať pomocnú funkciu $ BD_{n}^{(j)}(x) $ pre krivku $ x $, ktorá vyzerá takto:
\[
	BD^{(j)}_{n}(x) = {n \choose j}^{-1} \sum_{1 \leq i_{1} < i_{2} < ... < i_{j} \leq n} \mathcal{I}\{ G(x) \subset \mathcal{B}(x_{i_{1}}, ... ,x_{i_{j}}) \}, j \geq 2
\]
kde $ j $ je počet kriviek definujúce pásmo $ \mathcal{B} $, $ n $ je celkový počet kriviek a $ \mathcal{I} $ je takáto funkcia:
\[
	\mathcal{I}(x) = \left\{
	\begin{array}{ll}
	1 & \mbox{ak platí x}  \\
	0 & \mbox{ak neplatí x} 
	\end{array}
	\right.
\]
Pomocná funkcia $ BD $ pre krivku $ x $ definuje pomer všetkých pásem zložených z $ j $ kriviek, v ktorých sa graf $ G(x) $ nachádza, ku všetkým možným $ j $-ticiam kriviek vybraným z $ n $. 
Samotná funkcia pásmovej hĺbky $ \mathcal{BD} $ pre krivku $ x $ je definovaná takto:
\[
	\mathcal{BD}_{n, J}(x) = \sum_{j = 2}^{J} BD^{(j)}_{n}(x), J \geq 2
\]
Hĺbka pásma $ \mathcal{BD} $ je teda suma všetkých $ BD $ pre počet kriviek 2 až $ J $.

Autor článku definujúci pojem pásmová hĺbka navrhol taktiež flexibilnejšiu verziu s použitím pomocnej funkcie $ MBD $ (\textit{modified band depth}) \cite{BandDepth}. V pravom rade je potrebné zadefinovať si funkciu $ A $, ktorá určí všetky časové body, kedy sa krivka $ x $ nachádza v pásme $ B $.
\[
	A(x, B) = \{ t \in I : (t, x(t)) \in G(x) \wedge (t, x(t)) \in B \}
\]
V spomínanom článku autori využívajú alternatívnu definíciu funkcie $ A $, do ktorej vstupuje $ j + 1 $ kriviek. Jej význam zostáva rovnaký ako pri našej definícii, avšak náš prístup považujeme za jednoduchší a zrozumiteľnejší. S využitím \textit{Lebesguevoej miery} $ \lambda $ autori ďalej definujú funkciu $ \lambda_{r} $, ktorá nám dáva "pomer času, ktorý krivka strávi v pásme":
\[
	\lambda_{r}(A) = \dfrac{\lambda(A)}{\lambda(I)} 
\]
Nová pomocná funkcia $ MBD $ je definovaná nasledovne:
\[
	MBD^{(j)}_{n}(x) = {n \choose j}^{-1} \sum_{1 \leq i_{1} < i_{2} < ... < i_{j} \leq n} \lambda_{r}\{ A(x, \mathcal{B}(x_{i_{1}}, ... ,x_{i_{j}})) \}, j \geq 2
\]
Ak platí, že $ G(x) \subset \mathcal{B}(x_{i_{1}}, ... ,x_{i_{j}}) $, tak funkcia $ MBD $ sa degeneruje na $ BD $ \cite{FunctionalBoxplot}.

V našej aplikácii sme sa rozhodli, že budeme pásmo definovať pomocou iba dvoch kriviek, čo nám vzorec výrazne zjednodušilo. Taktiež to implikovalo fakt, že pri výpočte $ MBD $ nie je potrebné $ {n \choose j}^{-1} $, keďže berieme pásma zložené vždy z rovnakého počtu kriviek. Pre naše účely sme si taktiež zjednodušili funkciu $ \lambda_{r} $ na $ \lambda $, keďže nepotrebujeme vlastnosť tejto funkcie, ktorá dosahovala to, že $ MBD $ pre špeciálny prípad degeneruje na $ BD $. Po týchto úpravách výsledný vzorec pre naše $ \mathcal{BD}' $ vyzerá nasledovne:
\[
	\mathcal{BD}'_{n}(x) = \sum_{1 \leq i_{1} < i_{2} \leq n} \lambda\{ A(x, \mathcal{B}(x_{i_{1}},x_{i_{2}})) \}
\]
Teraz, keď sme úspešne definovali mieru, podľa ktorej môžme usporiadať funkcie resp. ich krivky, je veľmi ľahké skonštruovať funkčný krabicový diagram.

\paragraph{}
Nech sú naše funkcie predpovedí $ x_{1},.., x_{n} $ usporiadané zostupne podľa $ \mathcal{BD}' $. Potom krivka pre funkciu $ x_{1} $ má najvyššiu pásmovú hĺbku a predstavuje strednú hodnotu pre množinu funkcií, teda niečo podobné ako medián hodnôt pri krabicovom diagrame. Pri konštrukcii funkcionálneho diagramu nám taktiež pomôže koncept centrálneho regiónu \cite{Liu}. Centrálny región $ C $ pre 50\% kriviek je pásmo vytvorené z 50\% najhlbších kriviek, teda:
\[
	C_{0.5} = B(x_{1}, x_{2}, .., x_{\lceil n / 2 \rceil} )
\] 
Vidíme, že Centrálny región $ C_{0.5} $ zaobaľuje 50\% najhlbších kriviek, a teda sa jedná o akúsi analógiu pre medzikvartálový rozsah (IQR) v klasickom krabicovom diagrame (pozri sekciu \ref{subsec:boxplot}), ktorý ohraničoval 50\% centrálnych dát. Zobrazením hraničných bodov tohto regiónu získame obálku myšlienkovo totožnú boxu v krabicovom diagrame (pozri obrázok \ref{fig:functionalboxplot}b) ). Táto myšlienka sa dá použiť ďalej a môžme, tak ako na obrázku \ref{fig:functionalboxplot}c) , zobraziť taktiež 25\%-ný a 75\%-ný centrálny región $ C_{0.25} $, $ C_{0.75} $, avšak kvôli nižšej čitateľnosti grafu sme túto alternatívu nepoužili.

V prípade, že nepotrebujeme identifikovať \textit{outlier}-ov, tak extremálne hodnoty je už veľmi jednoduché získať, pretože ich tvorí pásmo zložené zo všetkých kriviek $ B(x_{1}, .., x_{n}) $. V opačnom prípade musíme najprv identifikovať \textit{outlier}-ov, ktorých potom vylúčime z výpočtov. Opäť sa využíva myšlienka z klasického krabicového diagramu, kedy sa \textit{outlier} určil pomocou hodnoty $ c \times IQR $, kde $ c $ bolo zvyčajne 1.5. Hranice sa teda získajú naškálovaním centrálneho regiónu so škálovacím faktorom 1.5 a všetky krivky, ktoré sa v tomto regióne nenachádzajú, budú považované za \textit{outlier}-ov. Test na \textit{outlier}-a vyzerá teda takto:
\[	y_{i}(t) = 1.5 \times x_{i}(t) \]
\[	isOutlier(x) = [ G(x) \nsubseteq B(y_{1},..,y_{\lceil n / 2 \rceil}) ] \]
Na obrázku \ref{fig:functionalboxplot}b) môžme vidieť červené prerušované čiary, ktorými sú \textit{outlier}-i znázornené.

V našej práci sme do diagramu pridali ešte jednu krivku pre ľubovoľnú štatistiku vypočítanú z chýb ako napríklad MFE, MAE alebo RMSE (pozri sekciu \ref{sec:errormeasurement}). Takto môžme spraviť porovnanie distribúcie chýb s vypočítanou štatistikou.
%TODO to je troška klamstvo ne?


\begin{figure}
	\centering
	\hspace*{-0.9in}
	\includegraphics[width = 7.5in]{functionalboxplot}
	\caption{Obrázky z článku \textit{Functional Boxplots}  \cite{FunctionalBoxplot}  a) Funkcie meraní teploty hladiny mora b) Funkčný krabicový diagram c) Rozšírený Funkčný krabicový diagram o centrálne regióny $ C_{0.25} $ a $ C_{0.75} $ }
	\label{fig:functionalboxplot}
\end{figure}


%TODO obrazok pasmo

\subsection{Distribucia za cely rok} %TODO lepsie pomenovat - tuto bude navrh pre distribuciu chyb pomocou standrard deviation a urobi sa kruzok danej velkosti


\subsection{Porovnanie metód}

Tu bude pekný obrázok a obkeci. \\
Graf hustoty je presnejsi, ale menej citatelny. \\
Pruhovy kvantilovy diagram nahradzuje krabicovy diagram. \\
Funkcionalny krabicovy riesi distribuciu funkcii.


\section{Návrh farebnej palety}
- rainbow a preco zle \\
- monochrome cez 3 farby \\
- monochrome 2 farby ostro rozdelene \\
- ekvalizacia histogramom / boxplotom \\
- navrh farby pre density, purhovy, functional boxplot \\

\section{Návrh rozloženia prvkov vizualizácie}
Výsledná obrazovka systému sa nebude skladať iba z jedného typu vizualizácie, ale z viacerých grafov a iných častí, ktoré spolu užívateľovi vytvoria dostatočne dobrú predstavu o dátach. Tieto časti budeme nazývať prvky alebo komponenty vizualizácie. Jednotlivým prvkom sme dali nasledovné pomenovania: 

\begin{itemize}
	\item\textit{Meta informácie} je tabuľka obsahujúca informácie o stanici (Názov, geografická poloha, nadmorská výška), názov modelu, interval verifikácie, spôsob interpolácie a podobne.  
		
	\item\textit{Prehľad} je komponent vizualizácie, ktorý by mal poskytovať celistvý pohľad na všetky mesačné štatistiky. Jeho úlohou nie je detailné zobrazenie chýb, ale odhalenie vzorov, trendov a výkyvov vo fungovaní modelu počas skúmaného intervalu.
	
	\item\textit{Zjednodušený prehľad} je vo svojej podstate rovnaký ako \textit{Prehľad}. Rozdielom je však menšia plocha, ktorú zaberá, zjednodušená farebná škála a chýbajúce popisky.
	
	\item\textit{Celkový priebeh} zobrazuje priebeh chýb počas celého intervalu. Nie však z pohľadu 48 predpovedných hodín (ako \textit{Prehľad}), ale z pohľadu jednotlivých dní.
	
	\item\textit{Detail štatistík} je prvok slúžiaci na detailnejšie skúmanie štatistík počas jedného mesiaca. V grafe sa nachádzajú všetky dostupné štatistiky pre daný mesiac.
	
	\item\textit{Detail chýb} pre daný mesiac, nám dáva pohľad na chyby predpovede, z ktorých sa počítali štatistiky.
	
	\item\textit{Distribúcia chýb} sa taktiež zobrazuje pre konkrétny mesiac a týmto komponentom je graf, v ktorom je zobrazená distribúcia chýb v danom mesiaci.
\end{itemize}

 Pre lepšiu orientáciu v kapitole sme pre jednotlivé prvky priradili aj obrázkové ikony. Jednotlivé priradenia sú vyobrazené na obrázku \ref{fig:designicons}. 
 
 Pri návrhu rozloženie prvkov vizualizácie na obrazovke sme sa rozhodovali medzi dvoma smermi uvažovania, ktoré opíšeme v tejto sekcii. 

\begin{figure}
	\centering
	\includegraphics[width = 4.5in]{designicons}
	\caption{Ikony pre jednotlivé prvky vizualizácie}
	\label{fig:designicons}
\end{figure}


\subsection{Viacúrovňový návrh rozloženia prvkov}
Jeden zo spôsobov uvažovania, ako rozložiť prvky vizualizácie, bolo zobraziť ich v jednotlivých úrovniach detailu: 
\begin{easylist}
	# \textit{Úroveň rokov}
	# \textit{Úroveň mesiacov}
	# \textit{Úroveň štatistík}
	# \textit{Úroveň chýb} 
\end{easylist}
Každá úroveň sa skladá z jedného alebo viacerých prvkov rovnakého typu. Napríklad \textit{Úroveň rokov} obsahuje iba prvky \textit{Zjednodušený prehľad}, ktorými sa zobrazujú celé roky. Obmedzením, ktoré kladieme na tento návrh, je zobrazenie maximálne dvoch úrovní súčasne. Touto požiadavkou dosiahneme jednak to, že prvky nebudú zbytočne presahovať mimo obrazovku a taktiež sa zachová do istej miery \textit{detail a kontext}. 

Medzi jednotlivými úrovňami je možný pohyb pomocou klikaním myši na jednotlivé prvky. Napríklad úrovni rokov kliknutím na jeden rok (prvok \textit{Zjednodušený prehľad}) sa nám zobrazí ďalšia úroveň ako prvok \textit{Prehľad}. Ďalším kliknutím na jeden mesiac v danom prvku sa pre daný mesiac zobrazí úroveň štatistík, ako prvok \textit{Detail štatistík}. Ďalej po kliknutí na jednu zo štatistík sa zobrazí prvok \textit{Distribúcia chýb}, v ktorom máme detailne zobrazené chyby, z ktorých sa nám daná štatistika počítala.

Na obrázku \ref{fig:multilevellayout} máme pomocou ikon z obrázka \ref{fig:designicons} schematicky popísané jednotivé úrovne a pohyb medzi nimi. Môžme si všimnúť, že v schéme nie je vidno prvok \textit{Detail chýb}. Dôvodom je, že sa nám kvôli jeho veľkosti nepodarilo nájsť umiestnenie tohto prvku jednak medzi úrovňami a rovnako aj v rámci úrovne.

\begin{figure}
	\centering
	\includegraphics[width = 3.5in]{multilevellayout}
	\caption{Schematické zobrazenie viacúrovňového návrhu rozloženia prvkov vizualizácie}
	\label{fig:multilevellayout}
\end{figure}


\subsection{Plochý návrh rozloženia prvkov}
Pre užívateľa nie je príjemné, keď sa na obrazovke prvky zväčšujú, zmenšujú, posúvajú, objavujú alebo miznú, pretože ... %TODO stráca prehľad alebo čo :D
Preto sme navrhli iný spôsob rozloženia, ktorý tento problém rieši tak, že zobrazí všetky prvky súčasne na jednej úrovni, a teda pojem \textit{úroveň} už nie je potrebný. Spôsob, akým sme umiestnili jednotlivé prvky je schematicky znázornený na obrázku \ref{fig:flatlayout}. Ak potrebujeme vidieť detailnejšie informácie o výkone modelu v mesiaci, tak kliknutím na konkrétny mesiac v prvku \textit{Prehľad}, sa zobrazí \textit{Detail štatistík}, \textit{Distribúcia chýb}, \textit{Detail chýb} pre daný mesiac.

Nevýhodou tohto návrhu je, že nemožno zobraziť viacero prvkov jedného typu súčasne. Z tohto dôvodu nie je možné porovnávať viacero rokov súčasne a preto nie je potrebný komponent \textit{Zjednodušený prehľad}. Zvyšné potrebné porovnávania pre mesiace a distribúciu zaobstará v zníženom, ale dostatočnom detaile, prvok \textit{Prehľad}. 

\begin{figure}
	\centering
	\includegraphics[width = 3.0in]{flatlayout}
	\caption{Schematické zobrazenie plochého návrhu rozloženia prvkov vizualizácie}
	\label{fig:flatlayout}
\end{figure}
